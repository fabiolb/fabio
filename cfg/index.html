<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>Config Language</title>

    
    <link href="/css/theDocs.all.min.css" rel="stylesheet">
    <link href="/css/skin/skin-blue.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    

    
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="manifest" href="/img/manifest.json">
    <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
  </head>

  <body data-spy="scroll" data-target=".sidebar" data-offset="400">
    
    <a id="top" href="#"></a>

    <header class="site-header sticky">
      <nav class="navbar navbar-default">
        <div class="container">

          
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar">
              <span class="glyphicon glyphicon-option-vertical"></span>
            </button>

            <button type="button" class="navbar-toggle for-sidebar" data-toggle="offcanvas">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="/"><img src="/img/logo-bw.svg" alt="logo"></a>
          </div>
          

          
          <div id="navbar" class="navbar-collapse collapse" aria-expanded="true" role="banner">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/quickstart/">Quickstart</a></li>
              <li><a href="/deploy/">Deployment</a></li>
              <li><a href="/feature/">Features</a></li>
              <li><a href="/ref/">Reference</a></li>
              <li><a href="/faq/">FAQ</a></li>
              <li><a target="_blank" href="https://twitter.com/search?q=%23fabiolb"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a></li>
              <li><a target="_blank" href="https://github.com/fabiolb/fabio"><i class="fa fa-github fa-2x" aria-hidden="true"></i></a></li>
            </ul>
          </div>
          

        </div>
      </nav>

    </header>



<main class="container">
  <div class="row">
    
<aside class="col-sm-3 sidebar sidebar-line">

  <ul class="nav sidenav dropable ">
    
    
    <li>
      <a class="" href="https://fabiolb.net/quickstart/">Quickstart</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/feature/">Features</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/deploy/">Deployment</a>
      
    </li>
    
    
    <li>
      <a class=" active" href="https://fabiolb.net/cfg/">Config Language</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/ref/">Reference</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/faq/">FAQ</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/contrib/">Contributing</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/code-of-conduct/">Code of Conduct</a>
      
    </li>
    
    
    <li>
      <a class="" href="https://fabiolb.net/contact/">Contact</a>
      
    </li>
    
  </ul>

</aside>


    
    <article class="col-sm-9 main-content" role="main">

      <section>
        <h2>Config Language</h2>
        
        <p>The routing table is configured with commands in the language specified below.
Rules are automatically generated by the configured backend. Additional rules
can be stored in the Consul KV store configured by
<a href="/ref/registry.consul.kvpath/"><code>registry.consul.kvpath</code></a> which by default is
<code>/fabio/config</code>.</p>
<p>As of fabio 1.5.7 the path is interpreted as a prefix and the values of all sub
keys are appended in alphabetical order. When the
<a href="/ref/log.routes.format/"><code>log.routes.format</code></a> is set to <code>all</code> then the routing
table contains comments on the source of the fragment.</p>
<h3 id="comments">Comments</h3>
<p>Blank lines and lines starting with <code>#</code> or <code>//</code> are ignored.</p>
<h3 id="route-add"><code>route add</code></h3>
<p>Add a route for a service <code>svc</code> for the <code>src</code> (e.g. <code>/path</code> or <code>:port</code>) to a <code>dst</code> (e.g. <code>URL</code> or <code>host:port</code>).</p>
<p><code>route add &lt;svc&gt; &lt;src&gt; &lt;dst&gt;[ weight &lt;w&gt;][ tags &quot;&lt;t1&gt;,&lt;t2&gt;,...&quot;][ opts &quot;k1=v1 k2=v2 ...&quot;]</code></p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>allow=ip:10.0.0.0/8,ip:fe80::/10</code></td>
<td>Restrict access to source addresses within the <code>10.0.0.0/8</code> or <code>fe80::/10</code> CIDR mask.  All other requests will be denied.</td>
</tr>
<tr>
<td><code>deny=ip:10.0.0.0/8,ip:fe80::1234</code></td>
<td>Deny requests that source from the <code>10.0.0.0/8</code> CIDR mask or <code>fe80::1234</code>.  All other requests will be allowed.</td>
</tr>
<tr>
<td><code>strip=/path</code></td>
<td>Forward <code>/path/to/file</code> as <code>/to/file</code></td>
</tr>
<tr>
<td><code>prepend=/prefix</code></td>
<td>Forward <code>/path/to/file</code> as <code>/prefix/path/to/file</code></td>
</tr>
<tr>
<td><code>proto=tcp</code></td>
<td>Upstream service is TCP, <code>dst</code> must be <code>:port</code></td>
</tr>
<tr>
<td><code>pxyproto=true</code></td>
<td>Enables PROXY protocol on outbount TCP connection</td>
</tr>
<tr>
<td><code>proto=https</code></td>
<td>Upstream service is HTTPS</td>
</tr>
<tr>
<td><code>tlsskipverify=true</code></td>
<td>Disable TLS cert validation for HTTPS upstream</td>
</tr>
<tr>
<td><code>host=name</code></td>
<td>Set the <code>Host</code> header to <code>name</code>. If <code>name == 'dst'</code> then the <code>Host</code> header will be set to the registered upstream host name</td>
</tr>
<tr>
<td><code>register=name</code></td>
<td>Register fabio as new service <code>name</code>. Useful for registering hostnames for host specific routes.</td>
</tr>
<tr>
<td><code>auth=name</code></td>
<td>Specify an auth scheme to use (must be registered with the fabio server using <code>proxy.auth</code>)</td>
</tr>
</tbody>
</table>
<h5 id="example">Example</h5>
<pre tabindex="0"><code># route traffic for product-svc to 1.2.3.4:8000 and :9000
route add product-svc /product http://1.2.3.4:8000
route add product-svc /product http://1.2.3.4:9000
</code></pre><h3 id="route-del"><code>route del</code></h3>
<p>Remove one or more routes which match the given criteria.</p>
<pre tabindex="0"><code>route del &lt;svc&gt;[ &lt;src&gt;[ &lt;dst&gt;]]
route del &lt;svc&gt; tags &#34;&lt;t1&gt;,&lt;t2&gt;,...&#34;
route del tags &#34;&lt;t1&gt;,&lt;t2&gt;,...&#34;
</code></pre><h5 id="example-1">Example</h5>
<pre tabindex="0"><code># remove all routes for &#39;product-svc&#39;
route del product-svc

# remove all routes for &#39;product-svc&#39; and /path
route del product-svc /path

# remove single route
route del product-svc /path http://1.2.3.4:8000

# remove all routes for &#39;product-svc&#39; matching a tag
route del product-svc tags &#34;green&#34;

# remove all routes matching a tag
route del tags &#34;yesterday&#34;
</code></pre><h3 id="route-weight"><code>route weight</code></h3>
<p>Directs a certain amount of traffic to instances matching certain criteria.</p>
<p>The weight <code>w</code> is expressed as follows:</p>
<ul>
<li><code>w</code> is a float &gt; 0 describing a percentage, e.g. 0.5 == 50%</li>
<li><code>w &lt;= 0</code>: means no fixed weighting. Traffic is evenly distributed</li>
<li><code>w &gt; 0</code>: route will receive n% of traffic. If sum(w) &gt; 1 then w is normalized.</li>
<li><code>sum(w) &gt;= 1</code>: only matching services will receive traffic</li>
</ul>
<p>Note that the total sum of traffic sent to all matching routes is <code>w</code>%.</p>
<p>The order of commands matters but routes are always ordered from most to least
specific by prefix length.</p>
<pre tabindex="0"><code>route weight &lt;svc&gt; &lt;src&gt; weight &lt;w&gt; tags &#34;&lt;t1&gt;,&lt;t2&gt;,...&#34;
route weight &lt;src&gt; weight &lt;w&gt; tags &#34;&lt;t1&gt;,&lt;t2&gt;,...&#34;
route weight &lt;svc&gt; &lt;src&gt; weight &lt;w&gt;
route weight service host/path weight w tags &#34;tag1,tag2&#34;
</code></pre><h5 id="example-2">Example</h5>
<pre tabindex="0"><code># Route 5% of the traffic to product-svc:/path with tags &#34;green&#34;
route weight product-svc /path weight .05 tags &#34;green&#34;

# Route 5% of the traffic to &#39;/path&#39; to the Go implementation.
# Route the rest (95%) to the other implementation
route weight /path weight .05 tags &#34;lang=go&#34;

# Route 5% of the traffice to &#39;/path&#39; on the product-svc-go
route weight product-svc-go /path weight .05
</code></pre><h3 id="routing-rules">Routing rules</h3>
<p>The routing table contains first all routes with a host sorted by prefix
length in descending order and then all routes without a host again sorted by
prefix length in descending order.</p>
<p>For each incoming request the routing table is searched top to bottom for a
matching route. A route matches if either <code>host/path</code> or - if there was no
match - just <code>/path</code> matches.</p>
<p>The matching route determines the target URL depending on the configured
strategy. <code>rnd</code> and <code>rr</code> are available with <code>rnd</code> being the default.</p>
<h5 id="example-3">Example</h5>
<p>The auto-generated routing table is</p>
<pre tabindex="0"><code>route add service-a www.mp.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-a www.kjca.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-a www.dba.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-b www.mp.dev/auth/ http://host-b:11080/ tags &#34;a,b&#34;
route add service-b www.kjca.dev/auth/ http://host-b:11080/ tags &#34;a,b&#34;
route add service-b www.dba.dev/auth/ http://host-b:11080/ tags &#34;a,b&#34;
</code></pre><p>The manual configuration under <code>/fabio/config</code> is</p>
<pre tabindex="0"><code>route del service-b www.dba.dev/auth/
route add service-c www.somedomain.com/ http://host-z:12345/
</code></pre><p>The complete routing table then is</p>
<pre tabindex="0"><code>route add service-a www.mp.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-a www.kjca.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-a www.dba.dev/accounts/ http://host-a:11050/ tags &#34;a,b&#34;
route add service-b www.mp.dev/auth/ http://host-b:11080/ tags &#34;a,b&#34;
route add service-b www.kjca.dev/auth/ http://host-b:11080/ tags &#34;a,b&#34;
route add service-c www.somedomain.com/ http://host-z:12345/
</code></pre>
      </section>

    </article>
    

  </div>
</main>

    
    <footer class="site-footer">
      <div class="container">
        <a id="scroll-up" href="#"><i class="fa fa-angle-up"></i></a>

        <div class="row">
          <div class="col-md-6 col-sm-6">
            <p style="line-height: 26px;">
                Copyright &copy; 2020-2022 Education Networks of America. All rights reserved.</br>
                Copyright &copy; 2017-2020 Frank Schr√∂der. All rights reserved.</br>
                Copyright &copy; 2015-2017 eBay Software Foundation.  All rights reserved</br>
                Last updated on 13 Sep 2022 19:32
            </p>
          </div>
          <div class="col-md-6 col-sm-6">
            <ul class="footer-menu">
              <li><a href="https://github.com/fabiolb/fabio/commits/master">Changelog</a></li>
              <li><a href="/contact/">Contact</a></li>
              <li>
                <a href="https://gohugo.io"><img src="/img/made-with-hugo.png" height="51px"></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2812942-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

    gtag('config', 'UA-2812942-5');
    </script>

    
    <script src="/js/theDocs.all.min.js"></script>
    <script src="/js/custom.js"></script>

  </body>
</html>

